# 消息顺序

Kafka只保证每个partion内的消息是有序的，如果要求全局消息一致那只能使用一个partion，这无疑会降低吞吐量。

一般来说只要业务上消息局部有序即可，比如一个userId对应的消息应该顺序消费。Kafka在sendMsg的时候可以指定topic，partion,key，那么我们让key=userId即可，因为key相同的消息会被hash后发送到相同的partion里。（那又引入了hash一致性的问题）。

同时在这种场景下sendMsg应该同步发送，异步发送注册回调函数这种做法会遇到这样的问题，发送消息1，2，3，消息2发送失败，回调函数重试后重新发送消息2成功，那么partion里储存的消息顺序实际上是1，3，2,不再有序。

